# EC2(Elastic Compute Cloud)

AWS에서 제공하는 클라우드 컴퓨팅이다.
AWS의 대표적인 서비스, 상품이며 다양한 기능을 제공해준다.

EC2에서 선택 가능한 OS

- Linux, Windows, Mac OS

t2.micro는 free tier이고 한달내내 켜놔도 됨.

public IPv4 address는 EC2인스턴스에 접근하기 위한 주소

private IPv4 address는 aws 네트워크 안에서 EC2 인스턴스에 접근하기 위한 주소

<br >

## EC2 인스턴스 유형

- m: 범용 인스턴스
  - 다양한 작업에 알맞음
  - 컴퓨팅,메모리,네트워크 간의 균형 잘 맞음
- c: 고성능의 CPU를 요구하는 인스턴스
  - 데이터 일괄 처리(배치)
  - 미디어 트랜스코딩 작업
  - 고성능의 웹서버
  - 머신러닝
- r: 메모리 최적화 인스턴스
  - 고성능의 관계형/비관계형 데이터베이스
  - 일라스틱 캐시와 같은 분산 웹스케일 캐시 저장소
  - Business intelligence에 최적화된 인메모리 데이터베이스
  - 대규모 비정형 데이터의 실시간 처리를 실행하는 app

### aws 네이밍 컨벤션의 예

ex) m5.2xlarge

- m: instance class
- 5: generation (AWS improves them over time)
- 2xlarge: size within the instnace class

<br >

## 보안 그룹

- Security Groups 은 EC2인스턴스의 방화벽
- port로의 액세스 통제
- 인증된 IP주소 범위를 확인해 IPv4인지 IPv6인지 확인
- 외부에서 인스턴스로 들어오는 인바운드 네트워크 통제
- 인스턴스에서 외부로 나가는 아웃바운드 네트워크 통제

<br >

## Classic Ports to know

- 22: SSH(Secure Shell) - 리눅스에서 ec2인스턴스로 로그인할때 사용됨.
- 21: FTP(File Transfer Protocol) - 파일 전송 프로토콜의 포트로 사용됨.
- 22: SFTP(Secure File Transfer Protocol) - SSH를 사용한 파일 전송 프로토콜의 포트로 사용됨.
- 80: HTTP - 보안이 되지 않은 웹사이트에 포트로 사용됨.
- 443: HTTPS - 보안이 적용된 웹사이트에 포트로 사용됨.
- 3389: RDP(Remote Desktop Protocol) - 원격 데스크톱 프로토콜의 포트로 사용됨.

<br >

## SSH

- SSH는 명령줄 인터페이스 도구로 Mac,Linux Windows10 이상 에서 사용 가능(윈도우 10 이하버전에서는 putty를 사용)
- SSH는 터미널이나 명령줄을 사용해 원격머신이나 서버를 제어할 수 있게 해줌
- Amazon Linux 2 AMI 에는 ec2-user라는 기본 사용자가 설정되어있음
- ssh로 인스턴스 접속 설정

```shell
$ chmod 400 .pem파일 // pem 파일 권한 설정
$ ssh -i .pem파일 ec2-user@publicIP주소 // 적용
```

<br >

## 스팟 인스턴스

- 스팟인스턴스는 배치 작업, 데이터분석, 실피해도 복원력 있는 워크로드에 사용
- 온디맨드 대비 최대 90% 저렴한 가격으로 사용 가능

### 스팟 요청

스팟 요청에는

- 원하는 인스턴스의 개수
- 지불 의사가 있는 인스턴스 최고 가격
- ami 등 요구되는 사양
- 요청의 유효기간
- 요청의 유형

등이 필요하다.

### 스팟 요청의 유형

스팟 요청의 유형에는 두 가지 유형이 있다.

- 스팟 인스턴스를 위한 일회성 요청
  - 한번만 실행되는 인스턴스, 후에 스팟 요청이 사라져도 괜찮은 경우에만 사용
- 사후 인스턴스를 위한 지속적인 요청
  - valid form, valid until을 설정해 스팟 인스턴스가 종료되면 다시 스팟 인스턴스를 생성해준다.

### 스팟 요청의 취소

스팟 요청이 취소되기 위해서는
open 상태, active 상태, disabled 상태여야 한다.
failed, cancelled, closed면 안됨

- 스팟 인스턴스를 종료하기 위한 과정
  - 먼저 스팟 요청을 취소해 aws가 더 이상 새로운 인스턴스를 실행하지 않게 한다.
  - 그 후에 연결된 스팟 인스턴스를 종료한다.

<br >

### 스팟 플릿(Spot Fleets)

- 스팟 플릿이란 한 세트의 스팟 인스턴스 에다가 선택적으로 온디맨드 인스턴스를 조합해 사용하는 방식이다.
- 스팟 플릿을 사용하면 비용 절감이 가능한데 알아서 적합한 스팟 인스턴스 풀을 선택해주기 때문이다.

### 스팟 인스턴스 할당 전략

- lowestPrice: 이 전략을 사용하면 스팟 플릿이 가장 적은 비용을 가진 풀에서부터 인스턴스를 실행해준다.
- diversified: 이 경우 스팟 인스턴스는 기존에 정의한 모든 풀에 걸쳐 분산이 된다.
  - 풀 하나가 죽어도 다른 풀에서 실행되므로 긴 워크로드에 적합하고 가용성이 뛰어난 옵션이다.
- capacityOptimized: 인스턴스 개수에 따라서 최적 용량으로 실행이 되고 적절한 풀을 찾아주는 옵션

<hr>

q1. ec2 예약 인스턴스를 에약할 수 있는 기간은 ?
a1. 1년 혹은 3년

q2. EC2 인스턴스에 고성능 컴퓨팅(HPC) 애플리케이션을 배포하려 합니다. 다음 중 어떤 EC2 인스턴스 유형을 선택해야 할까요?
a2. 컴퓨팅 최적화

q3. 1년 간 지속적으로 서버를 운영할 계획인 애플리케이션의 경우에는 다음 중 어떤 EC2 구매 옵션을 사용해야 할까요?
a3. 예약 인스턴스

q4. 일련의 EC2 인스턴스에 호스팅 될 애플리케이션을 실행하려 합니다. 이 애플리케이션에는 소프트웨어 설치가 필요하며, 최초 실행 중에 일부 OS 패키지를 업데이트해야 합니다. EC2 인스턴스를 실행하려는 경우, 이를 위한 최적의 방식은 무엇일까요?
a4. bash script 작성해서 ec2 실행시 user-data에 넣어서 실행

q5. 인메모리 데이터베이스를 사용하는 중요 애플리케이션을 위해서는 다음 중 어떤 EC2 인스턴스 유형을 선택해야 할까요?
a5. 메모리 최적화

q6. 온프레미스에 호스팅된 OLTP 데이터베이스를 갖춘 전자 상거래 애플리케이션이 있습니다. 이 애플리케이션은 인기가 좋아, 데이터베이스가 초당 수천 개의 요청을 지니게 됩니다. 여러분은 데이터베이스를 EC2 인스턴스로 이전하려 합니다. 이렇게 높은 빈도를 보이는 OLTP 데이터베이스를 처리하기 위해서는 어떤 EC2 인스턴스 유형을 선택해야 할까요?
a6. 스토리지 최적화

q7. (참/거짓) 보안 그룹은 오직 하나의 EC2 인스턴스에만 연결될 수 있습니다.
a7. 아닙니다.

q8. 온프레미스 애플리케이션을 AWS로 이전하려 합니다. 여러분의 기업에는 애플리케이션을 전용 서버에서 실행해야 한다는 엄격한 규정이 있습니다. 또한 비용 절감을 위해 전용 서버 바운드 소프트웨어 라이선스를 사용해야 합니다. 이 경우, 다음 중 어떤 EC2 구매 옵션이 적합할까요?
a8. 전용 호스트 -> 가장 비싼 ec2 옵션이라는데 왜 정답이지?

q9. 데이터베이스 기술을 EC2 인스턴스에 배포하려 합니다. 공급 업체 라이선스는 물리적 코어 및 기반 네크워크 소켓 가시성를 기반으로 비용을 책정합니다. 이 경우, 어떤 EC2 구매 옵션을 사용해야 가시성을 확보할 수 있을까요?
a9. 전용 호스트
